<div style="width: 100%;height: 100%;top: 0px;left: 0px;position: fixed;display: block; z-index: 99; background: rgba(255, 255, 255, 0.3)" ng-show="vm.loading">
    <div style="position: absolute;top: 15%;z-index: 100; width: 100%; text-align: center;">
        <div class="sk-circle">
            <div class="sk-circle1 sk-child"></div>
            <div class="sk-circle2 sk-child"></div>
            <div class="sk-circle3 sk-child"></div>
            <div class="sk-circle4 sk-child"></div>
            <div class="sk-circle5 sk-child"></div>
            <div class="sk-circle6 sk-child"></div>
            <div class="sk-circle7 sk-child"></div>
            <div class="sk-circle8 sk-child"></div>
            <div class="sk-circle9 sk-child"></div>
            <div class="sk-circle10 sk-child"></div>
            <div class="sk-circle11 sk-child"></div>
            <div class="sk-circle12 sk-child"></div>
        </div>
    </div>
</div>

<div class="form-group col-md-12">
    <div class="header" ng-show="vm.selectedTypeCreditNote === undefined">
        <h4><b>Nota de Cr&eacute;dito</b></h4>
    </div>
    <div class="header" ng-show="vm.selectedTypeCreditNote === '1'">
        <h4><b>Nota de Cŕedito de Facturas de Ventas</b></h4>
    </div>
    <div class="header" ng-show="vm.selectedTypeCreditNote === '2'">
        <h4><b>Nota de Cŕedito de Facturas de Compras</b></h4>
    </div>
    <div class="header" ng-show="vm.selectedTypeCreditNote === '3'">
        <h4><b>Nota de Cŕedito de Facturas Offline</b></h4>
    </div>

    <div class="row" ng-show="vm.error !== undefined">
        <div class="form-group col-md-12">
            <div class="alert alert-danger">{{vm.error}}</div>
        </div>
    </div>
    <div class="row" ng-show="vm.success !== undefined">
        <div class="form-group col-md-12">
            <div class="alert alert-success">{{vm.success}}</div>
        </div>
    </div>

    <div class="row" ng-show="vm.selectedTypeCreditNote === undefined">
        <div class="form-group col-md-6">
            <button type="button" class="btn btn-primary btn-block" ng-click="vm.loadTypeCreditNote('1')">
                NOTA DE CRÉDITO - FACTURAS DE VENTAS        
            </button>
        </div>
        <div class="form-group col-md-6">
            <button type="button" class="btn btn-primary btn-block" ng-click="vm.loadTypeCreditNote('2')">
                NOTA DE CRÉDITO - FACTURAS DE COMPRAS        
            </button>
        </div>
        <div class="form-group col-md-6">
            <button type="button" class="btn btn-primary btn-block" ng-click="vm.loadTypeCreditNote('3')">
                NOTA DE CRÉDITO - FACTURAS OFFLINE        
            </button>
        </div>
        <div class="form-group col-md-12">
            <button type="button" title="Volver a Inicio" class="btn btn-danger btn-sm"
                    ng-click="vm.exit()">
                    <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>
            </button>
        </div>
    </div>

    <!--CARGA DE CLIENTES PARA NOTA DE CRÉDITO DE FACTURAS DE VENTAS-->
    <div ng-show="vm.selectedTypeCreditNote === '1' && vm.clientSelected === undefined && vm.bill === undefined && vm.creditNote === undefined">
        <div class="row">
            <div class="form-group col-md-12">
                <input ng-model = "searchText" class = "form-control" placeholder = "Buscar Clientes">
            </div>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>C&oacute;digo</th>
                    <th>Nombre</th>
                    <th>No. Identidad</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-show="vm.clientList == 0">
                    <td colspan="4">
                        No hay Clientes ingresados
                    </td>
                </tr>
                <tr ng-repeat="clientPreSelect in vm.clientList | orderBy:'name' | filter:searchText">
                    <td>{{clientPreSelect.codApp}}</td>
                    <td>{{clientPreSelect.name}}</td>
                    <td>{{clientPreSelect.typeId}} - {{clientPreSelect.identification}}</td>
                    <td>
                        <button type="button" title="Buscar Facturas" class="btn btn-primary btn-sm" ng-click="vm.clientSelect(clientPreSelect)"
                                data-toggle="modal" data-target="#modalBills">
                                <span class = "glyphicon glyphicon-search" aria-hidden = "true"></span>
                        </button>
                        <button type="button" title="Buscar Notas de Cŕedito" class="btn btn-success btn-sm" ng-click="vm.creditsNoteByClient(clientPreSelect)"
                                data-toggle="modal" data-target="#modalNotes">
                                <span class = "glyphicon glyphicon-zoom-in" aria-hidden = "true"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="row">
            <div class="form-group col-md-12">
                <button type="button" title="Volver" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>

    <!--CARGA DE PROVEEDORES PARA NOTA DE CRÉDITO DE FACTURAS DE COMPRAS-->
    <div ng-show="vm.selectedTypeCreditNote === '2' && vm.providerSelected === undefined && vm.cellar === undefined && vm.creditNote === undefined">
        <div class="row">
            <div class="form-group col-md-12">
                <input ng-model = "searchText" class = "form-control" placeholder = "Buscar Proveedores">
            </div>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>C&oacute;digo</th>
                    <th>Nombre Comercial</th>
                    <th>Raz&oacute;n Social</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-show="vm.providerList == 0">
                    <td colspan="4">
                        No hay Proveedores ingresados
                    </td>
                </tr>
                <tr ng-repeat="providerSelect in vm.providerList | orderBy:'name' | filter:searchText">
                    <td>{{providerSelect.codeIntegridad}}</td>
                    <td>{{providerSelect.name}}</td>
                    <td>{{providerSelect.razonSocial}}</td>
                    <td>
                        <button type="button" title="Buscar Facturas" class="btn btn-primary btn-sm" ng-click="vm.providerSelect(providerSelect)"
                                data-toggle="modal" data-target="#modalCellars">
                                <span class = "glyphicon glyphicon-search" aria-hidden = "true"></span>
                        </button>
                        <button type="button" title="Buscar Notas de Cŕedito" class="btn btn-success btn-sm" ng-click="vm.creditsNoteByProvider(providerSelect)"
                                data-toggle="modal" data-target="#modalNotesCellar">
                                <span class = "glyphicon glyphicon-zoom-in" aria-hidden = "true"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="row">
            <div class="form-group col-md-12">
                <button type="button" title="Volver" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>

    <!--CARGA DE CLIENTES PARA NOTA DE CRÉDITO DE FACTURAS OFFLINE-->
    <div ng-show="vm.selectedTypeCreditNote === '3' && vm.clientSelected === undefined && vm.billOffline === undefined && vm.creditNote === undefined">
        <div class="row">
            <div class="form-group col-md-12">
                <input ng-model = "searchText" class = "form-control" placeholder = "Buscar Clientes">
            </div>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>C&oacute;digo</th>
                    <th>Nombre</th>
                    <th>No. Identidad</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-show="vm.clientList == 0">
                    <td colspan="4">
                        No hay Clientes ingresados
                    </td>
                </tr>
                <tr ng-repeat="clientOffSelect in vm.clientList | orderBy:'name' | filter:searchText">
                    <td>{{clientOffSelect.codApp}}</td>
                    <td>{{clientOffSelect.name}}</td>
                    <td>{{clientOffSelect.typeId}} - {{clientOffSelect.identification}}</td>
                    <td>
                        <button type="button" title="Buscar Facturas" class="btn btn-primary btn-sm" ng-click=""
                                data-toggle="modal" data-target="#modalBillsOffline">
                                <span class = "glyphicon glyphicon-search" aria-hidden = "true"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="row">
            <div class="form-group col-md-12">
                <button type="button" title="Volver" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>

    <!--CREACIÓN DE LA NOTA DE CRÉDITO DE FACTURAS DE VENTA-->
    <div class="panel-group" ng-show="vm.clientSelected !== undefined && vm.bill !== undefined"  print-section>
        <div class="panel panel-primary">
            <div class="panel-heading" print-remove>
                <b>Datos del Cliente</b>
            </div>
            <div class="panel-body">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td width="30%" align="center"><img src="images/{{vm.companyData.userClient.logo}}" ><br></td>
                            <td width="70%">
                                <b>{{vm.companyData.userClient.name}}</b><br/></br>
                                <b>Matriz: {{vm.companyData.userClient.address1}}</b><br/>
                                <b>Establecimiento: {{vm.companyData.address1}}</b><br/><br/>
                                <b>RUC: {{vm.companyData.userClient.ruc}}</b><br/>
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td width="30%">
                                <label>FECHA NOTA DE CREDITO: </label>
                                <div class="input-group date" id="pickerCreditNoteDate">
                                    <input type="text" class="form-control input-group-addon"/>
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"/></span>
                                </div>
                                <script>
                                    var defaultDate = new Date();
                                    $('#pickerCreditNoteDate').datetimepicker({format: "DD/MM/YY",});
                                </script>
                            </td>
                            <td width="70%">
                                <div style=" padding-left: 10px" >
                                    <label>CLAVE DE ACCESO: </label><br/>
                                    {{vm.claveDeAcceso}}
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td>
                                <b>NOMBRE: </b>{{vm.clientSelected.name}}<br/>
                            </td>
                            <td>
                                <b ng-if="vm.clientSelected.typeId === 'CED'">CEDULA: </b>
                                <b ng-if="vm.clientSelected.typeId === 'RUC'">RUC: </b>
                                {{vm.clientSelected.identification}}
                            </td>
                            <td>
                                <b>TELEFONO: </b>{{vm.clientSelected.phone}}
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td><b>DIRECCION: </b>{{vm.clientSelected.address}}</td>
                            <td><b>E-MAIL: </b>{{vm.clientSelected.email}}</td>
                        </tr>
                        <tr>
                            <td>
                                <b>No FACTURA: </b> {{vm.bill.documentStringSeq}}
                            </td>
                            <td print-remove>
                                <b>PRECIO CONVENIDO: </b>
                                <select ng-options="price as price.name for price in vm.prices" ng-if="vm.newBill"
                                        ng-model="vm.priceType" class="form-control" ng-change="vm.reCalculateTotal()" ng-disabled="vm.bill.details.length > 0">
                                </select>
                                <span ng-if="!vm.newBill">{{vm.bill.priceType}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>FECHA DE FACTURA: </b> {{vm.bill.dateCreated | date : "dd/MM/yyyy"}}
                            </td>
                            <td>
                                <b>No NOTA DE CREDITO: </b> {{vm.seqNumber}}
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12" ng-if="vm.companyData.userClient.espTemp == 'A-1'" print-if="vm.companyData.userClient.espTemp == 'A-1'">
                    <table width="100%" style="border-collapse: separate; border-spacing: 6px;">
                        <tr>
                            <td width="50%">
                                <b>ORDEN DE COMPRA: </b>
                                <input type="text" ng-disabled="!vm.newBill"
                                       ng-model="vm.bill.ordenDecompra" class="form-control">
                            </td>
                            <td width="50%">
                                <b>SERVICES RECEIPTS REGISTER: </b>
                                <input type="text" ng-disabled="!vm.newBill"
                                       ng-model="vm.bill.srr" class="form-control">
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <b>LUGAR: </b>
                                <input type="text" ng-disabled="!vm.newBill"
                                       ng-model="vm.bill.lugar" class="form-control">
                            </td>
                            <td width="50%">
                                <b>OTI/OTIR: </b>
                                <input type="text" ng-disabled="!vm.newBill"
                                       ng-model="vm.bill.otir" class="form-control">
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-6">
                    <b>DESCUENTO &#37;: </b>
                    <input type="text" ng-change="vm.reCalculateTotal()" onkeypress="return ((event.which >= 48 && event.which <= 57) || (event.keyCode == 9 || event.keyCode == 8))"
                           ng-model="vm.bill.discountPercentage" class="form-control" maxlength="9" ng-change="vm.getFechaCobro()" ng-disabled="!vm.newBill">
                </div>
            
                <div class="form-group col-md-12">
                    <b>MOTIVO: </b>
                    <input type="text" ng-model="vm.bill.motivo" class="form-control">
                </div>
            </div>
        </div>
        
        <div class="panel panel-primary">
            <div class="panel-heading">
                <b>Detalle</b>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-md-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th> Item </th>
                                    <th> C&oacute;digo </th>
                                    <th> Nombre Producto </th>
                                    <th> Descripci&oacute;n </th>
                                    <th> Cant. </th>
                                    <th> U. Med. </th>
                                    <th> V. Unit. </th>
                                    <th> Desc. </th>
                                    <th> V. Total. </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-show="vm.clientList == 0">
                                    <td colspan="4">
                                        No hay detalles ingresados
                                    </td>
                                </tr>
                                <tr ng-repeat="detail in vm.bill.details">
                                    <td>{{$index + 1}}</td>
                                    <td>{{detail.product.codeIntegridad}}</td>
                                    <td>{{detail.product.name}}</td>
                                    <td>{{detail.adicional}}</td>
                                    <td>{{detail.quantity}}</td>
                                    <td>{{detail.product.unitOfMeasurementFull}}</td>
                                    <td>{{detail.costEach}}</td>
                                    <td>{{detail.discount}}</td>
                                    <td>{{detail.total}}</td>
                                    <td>
                                        <button type="button" title="Editar Producto" class="btn btn-primary btn-sm"
                                                ng-click="vm.editDetail($index)" print-remove
                                                data-toggle="modal" data-target="#modalEditDetail">
                                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                        </button>
                                        <button type="button" title="Eliminar Producto" class="btn btn-primary btn-sm"
                                                ng-click="vm.removeDetail($index)" print-remove>
                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>SUBTOTAL: </b></td>
                                    <td>{{(vm.bill.subTotal).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>DESCUENTO: </b></td>
                                    <td>{{(vm.bill.discount).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 0%: </b></td>
                                    <td>{{(vm.bill.baseNoTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 12%: </b></td>
                                    <td>{{(vm.bill.baseTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>IVA: </b></td>
                                    <td>{{(vm.bill.iva).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>TOTAL: </b></td>
                                    <td>{{(vm.bill.total).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="panel-footer" print-remove>
                <button type="button" title="Guardar Nota de Cŕedito" class="btn btn-success btn-sm" ng-disabled="vm.bill.total <= 0"
                        ng-show="vm.claveDeAcceso === undefined" ng-click="vm.saveCreditNote()">
                        <span class = "glyphicon glyphicon-floppy-save" aria-hidden = "true"></span>
                </button>
                <button print-btn type="button" title="Imprimir Nota de Crédito" class="btn btn-primary btn-sm"
                        ng-disabled="vm.claveDeAcceso === undefined; vm.error !== undefined" ng-click="vm.cancelBill()">
                        <span class = "glyphicon glyphicon-print" aria-hidden = "true"></span>
                </button>
                <button type="button" title="Salir" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                </button>
            </div>
        </div>
    </div>

    <div id="modalEditDetail" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Detalle</h4>
                </div>
                <div class="modal-body">
                    <div class="col-md-6" >
                        <b>PRODUCTO: </b>
                        {{vm.detail.product.name}}
                    </div>
                    <div class="col-md-6" >
                        <b>CANTIDAD: </b>
                        <input type="text" onkeypress="return ((event.which >= 48 && event.which <= 57) || (event.keyCode == 9 || event.keyCode == 8))"
                               ng-model="vm.detail.quantity" class="form-control" maxlength="9">
                    </div>            
                </div>
                <div class="modal-footer">
                    <button type="button" title="Aceptar" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.editNewDetail()">
                            <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                    </button>
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.detail = undefined; vm.indexDetail=undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalBills" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" ng-click="vm.clientSelected=undefined; vm.billList = undefined">&times;</button>
                    <h4 class="modal-title">Facturas</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12" >
                            <div ng-show="vm.billList !== undefined">
                                <input ng-model="searchTextBills" class="form-control" placeholder="Buscar">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>N&uacute;mero</th>
                                            <th>Fecha</th>
                                            <th>Cliente</th>
                                            <th>Total</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-show="vm.billList == 0">
                                            <td colspan="4">
                                                No hay Facturas de Venta ingresadas, para Notas de Cr&eacute;dito
                                            </td>
                                        </tr>
                                        <tr ng-repeat="bill in vm.billList | orderBy:'dateCreated':true | filter:searchTextBills">
                                            <td>{{bill.stringSeq}}</td>
                                            <td>{{bill.dateCreated | date :  "dd/MM/yyyy"}}</td>
                                            <td>{{bill.client.name}}</td>
                                            <td>{{bill.total}}</td>
                                            <td>
                                                <button type="button" title="Crear Nota de Crédito" class="btn btn-primary btn-sm" ng-click="vm.billSelect(bill)"
                                                        data-dismiss="modal">
                                                        <span class = "glyphicon glyphicon-file" aria-hidden = "true"></span>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.billList = undefined; vm.clientSelected=undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalNotes" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" ng-click="vm.creditNoteList = undefined">&times;</button>
                    <h4 class="modal-title">Notas de Cr&eacute;dito -- {{vm.clientName}}</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12" >
                            <div ng-show="vm.creditNoteList !== undefined">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>N&uacute;mero</th>
                                            <th>Fecha</th>
                                            <th>Factura</th>
                                            <th>Total</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-show="vm.creditNoteList == 0">
                                            <td colspan="4">
                                                No hay Notas de Cŕedito realizadas para este Cliente
                                            </td>
                                        </tr>
                                        <tr ng-repeat="creditNote in vm.creditNoteList | orderBy:'dateCreated':true">
                                            <td>{{creditNote.stringSeq}}</td>
                                            <td>{{creditNote.dateCreated | date :  "dd/MM/yyyy"}}</td>
                                            <td>{{creditNote.documentStringSeq}}</td>
                                            <td>{{creditNote.total}}</td>
                                            <td>
                                                <button type="button" title="Ver Nota de Crédito" class="btn btn-primary btn-sm" ng-click="vm.creditNoteSelect(creditNote)"
                                                        data-dismiss="modal">
                                                        <span class = "glyphicon glyphicon-file" aria-hidden = "true"></span>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.creditNoteList = undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalCellars" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Facturas de Compra</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12" >
                            <div ng-show="vm.cellarList !== undefined">
                                <input ng-model="searchTextCellars" class="form-control" placeholder="Buscar">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Nro. Factura</th>
                                            <th>Fecha</th>
                                            <th>Proveedor</th>
                                            <th>Total</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-show="vm.cellarList == 0">
                                            <td colspan="4">
                                                No hay Facturas de Compra ingresadas, para Notas de Cr&eacute;dito
                                            </td>
                                        </tr>
                                        <tr ng-repeat="cellar in vm.cellarList | orderBy:'dateCreated':true | filter:searchTextCellars">
                                            <td>{{cellar.billNumber}}</td>
                                            <td>{{cellar.dateBill | date :  "dd/MM/yyyy"}}</td>
                                            <td>{{cellar.provider.razonSocial}}</td>
                                            <td>{{cellar.total}}</td>
                                            <td>
                                                <button type="button" title="Crear Nota de Crédito" class="btn btn-primary btn-sm" ng-click="vm.cellarSelect(cellar)"
                                                        data-dismiss="modal">
                                                        <span class = "glyphicon glyphicon-file" aria-hidden = "true"></span>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.cellarList = undefined; vm.providerSelected = undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalNotesCellar" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" ng-click="vm.creditNoteCellarList = undefined">&times;</button>
                    <h4 class="modal-title">Notas de Cr&eacute;dito -- {{vm.providerName}}</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12" >
                            <div ng-show="vm.creditNoteCellarList !== undefined">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>N&uacute;mero</th>
                                            <th>Fecha</th>
                                            <th>Factura</th>
                                            <th>Total</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-show="vm.creditNoteCellarList == 0">
                                            <td colspan="4">
                                                No hay Notas de Cŕedito realizadas para este Proveedor
                                            </td>
                                        </tr>
                                        <tr ng-repeat="creditNote in vm.creditNoteCellarList | orderBy:'dateCreated':true">
                                            <td>{{creditNote.stringSeq}}</td>
                                            <td>{{creditNote.dateCreated | date :  "dd/MM/yyyy"}}</td>
                                            <td>{{creditNote.documentStringSeq}}</td>
                                            <td>{{creditNote.total}}</td>
                                            <td>
                                                <button type="button" title="Ver Nota de Crédito" class="btn btn-primary btn-sm" ng-click="vm.creditNoteCellarSelect(creditNote)"
                                                        data-dismiss="modal">
                                                        <span class = "glyphicon glyphicon-file" aria-hidden = "true"></span>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss="modal"
                            ng-click="vm.creditNoteList = undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--VISUALIZA LA NOTA DE CREDITO DE VENTA CREADA PARA IMPRIMIR-->
    <div class="panel-group" ng-show="vm.creditNote !== undefined"  print-section>
        <div class="panel panel-primary">
            <div class="panel-heading" print-remove>
                <b>Datos del Cliente</b>
            </div>
            <div class="row">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td width="30%" align="center"><img src="images/{{vm.companyData.userClient.logo}}" ><br></td>
                            <td width="70%">
                                <b>{{vm.companyData.userClient.name}}</b><br/></br>
                                <b>Matriz: {{vm.companyData.userClient.address1}}</b><br/>
                                <b>Establecimiento: {{vm.companyData.address1}}</b><br/><br/>
                                <b>RUC: {{vm.companyData.userClient.ruc}}</b><br/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td width="30%">
                                <label>FECHA NOTA DE CREDITO: </label>
                                {{vm.creditNote.dateCreated | date : "dd/MM/yyyy"}}
                            </td>
                            <td width="70%">
                                <div style=" padding-left: 10px" >
                                    <label>CLAVE DE ACCESO: </label><br/>
                                    {{vm.creditNote.claveDeAcceso}}
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td>
                                <b>NOMBRE: </b>{{vm.creditNote.client.name}}<br/>
                            </td>
                            <td>
                                <b ng-if="vm.clientSelected.typeId === 'CED'">CEDULA: </b>
                                <b ng-if="vm.clientSelected.typeId === 'RUC'">RUC: </b>
                                {{vm.creditNote.client.identification}}
                            </td>
                            <td>
                                <b>TELEFONO: </b>{{vm.creditNote.client.phone}}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td><b>DIRECCION: </b>{{vm.creditNote.client.address}}</td>
                            <td><b>E-MAIL: </b>{{vm.creditNote.client.email}}</td>
                        </tr>
                        <tr>
                            <td><b>No NOTA DE CREDITO: </b> {{vm.creditNote.stringSeq}}</td>
                            <td><b>No FACTURA: </b> {{vm.creditNote.documentStringSeq}}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row" ng-if="vm.companyData.userClient.espTemp == 'A-1'" print-if="vm.companyData.userClient.espTemp == 'A-1'">
                <div class="form-group col-md-12 ">
                    <table width="100%" style="border-collapse: separate; border-spacing: 6px;">
                        <tr>
                            <td width="50%">
                                <b>ORDEN DE COMPRA: </b>
                                {{vm.creditNote.ordenDecompra}}
                            </td>
                            <td width="50%">
                                <b>SERVICES RECEIPTS REGISTER: </b>
                                {{vm.creditNote.srr}}
                            </td>
                        </tr>
                        <tr>
                            <td width="50%">
                                <b>LUGAR: </b>
                                {{vm.creditNote.lugar}}
                            </td>
                            <td width="50%">
                                <b>OTI/OTIR: </b>
                                {{vm.creditNote.otir}}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="form-group col-md-6">
                    <b>DESCUENTO &#37;: </b>
                    {{vm.creditNote.discount}}
                </div>
            </div>
            
            <div class="row">
                <div class="form-group col-md-12">
                    <b>MOTIVO: </b>
                    {{vm.creditNote.motivo}}
                </div>
            </div>
        </div>
        
        <div class="panel panel-primary">
            <div class="panel-heading">
                <b>Detalle</b>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-md-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th> Item </th>
                                    <th> C&oacute;digo </th>
                                    <th> Nombre Producto </th>
                                    <th> Descripci&oacute;n </th>
                                    <th> Cant. </th>
                                    <th> U. Med. </th>
                                    <th> V. Unit. </th>
                                    <th> Desc. </th>
                                    <th> V. Total. </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="detail in vm.creditNote.details">
                                    <td>{{$index + 1}}</td>
                                    <td>{{detail.product.codeIntegridad}}</td>
                                    <td>{{detail.product.name}}</td>
                                    <td>{{detail.adicional}}</td>
                                    <td>{{detail.quantity}}</td>
                                    <td>{{detail.product.unitOfMeasurementFull}}</td>
                                    <td>{{detail.costEach}}</td>
                                    <td>{{detail.discount}}</td>
                                    <td>{{detail.total}}</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>SUBTOTAL: </b></td>
                                    <td>{{(vm.creditNote.subTotal).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>DESCUENTO: </b></td>
                                    <td>{{(vm.creditNote.discount).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 0%: </b></td>
                                    <td>{{(vm.creditNote.baseNoTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 12%: </b></td>
                                    <td>{{(vm.creditNote.baseTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>IVA: </b></td>
                                    <td>{{(vm.creditNote.iva).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>TOTAL: </b></td>
                                    <td>{{(vm.creditNote.total).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="panel-footer" print-remove>
                <button print-btn type="button" title="Imprimir Nota de Crédito" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class = "glyphicon glyphicon-print" aria-hidden = "true"></span>
                </button>
                <button type="button" title="Salir" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                </button>
            </div>
        </div>
    </div>

    <!--CREACIÓN DE LA NOTA DE CRÉDITO DE FACTURA DE COMPRAS-->
    <div class="panel-group" ng-show="vm.providerSelected !== undefined && vm.cellar !== undefined"  print-section>
        <div class="panel panel-primary">
            <div class="panel-heading" print-remove>
                <b>Datos del Proveedor</b>
            </div>
            <div class="panel-body">
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td width="30%" align="center"><img src="images/{{vm.companyData.userClient.logo}}" ><br></td>
                            <td width="70%">
                                <b>{{vm.companyData.userClient.name}}</b><br/></br>
                                <b>Matriz: {{vm.companyData.userClient.address1}}</b><br/>
                                <b>Establecimiento: {{vm.companyData.address1}}</b><br/><br/>
                                <b>RUC: {{vm.companyData.userClient.ruc}}</b><br/>
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td ng-if="vm.newCNCellar">
                                <b>No NOTA DE CREDITO: </b> {{vm.seqNumbCredNotCellar}}
                            </td>
                            <td ng-if="!vm.newCNCellar">
                                <b>No NOTA DE CREDITO: </b> {{vm.cellar.stringSeq}}
                            </td>
                            <td ng-if="vm.newCNCellar">
                                <label>FECHA NOTA DE CREDITO: </label>
                                <div class="input-group date" id="pickerCreditNoteCellarDate">
                                    <input type="text" class="form-control input-group-addon"/>
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"/></span>
                                </div>
                                <script>
                                    var defaultDate = new Date();
                                    $('#pickerCreditNoteCellarDate').datetimepicker({format: "DD/MM/YY",});
                                </script>
                            </td>
                            <td ng-if="!vm.newCNCellar">
                                <label>FECHA NOTA DE CREDITO: </label>
                                {{vm.cellar.dateCreated | date : "dd/MM/yyyy"}}
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td>
                                <b>NOMBRE: </b>{{vm.providerSelected.razonSocial}}<br/>
                            </td>
                            <td>
                                <b ng-if="vm.providerSelected.rucType === 'CED'">CEDULA: </b>
                                <b ng-if="vm.providerSelected.rucType === 'RUC'">RUC: </b>
                                {{vm.providerSelected.ruc}}
                            </td>
                            <td>
                                <b>TELEFONO: </b>{{vm.providerSelected.phone}} - {{vm.providerSelected.celPhone}}
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12 ">
                    <table width="100%">
                        <tr>
                            <td><b>DIRECCION: </b>{{vm.providerSelected.address1}}</td>
                            <td><b>E-MAIL: </b>{{vm.providerSelected.email}}</td>
                        </tr>
                        <tr>
                            <td>
                                <b>No FACTURA: </b> {{vm.cellar.documentStringSeq}}
                            </td>
                            <td>
                                <b>FECHA DE FACTURA: </b> {{vm.cellar.dateBill | date :  "dd/MM/yyyy"}}
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="form-group col-md-12" ng-if="vm.newCNCellar">
                    <b>MOTIVO: </b>
                    <input type="text" ng-model="vm.cellar.motivo" class="form-control">
                </div>

                <div class="form-group col-md-12" ng-if="!vm.newCNCellar">
                    <b>MOTIVO: </b>
                    {{vm.cellar.motivo}}
                </div>
            </div>
        </div>
        
        <div class="panel panel-primary">
            <div class="panel-heading">
                <b>Detalle</b>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-md-12">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>C&oacute;digo</th>
                                    <th>Nombre Producto</th>
                                    <th>Descripci&oacute;n</th>
                                    <th>Cant.</th>
                                    <th>U. Med.</th>
                                    <th>V. Unit.</th>
                                    <th>V. Total.</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-show="vm.cellar.detailsCellar == 0">
                                    <td colspan="4">
                                        No hay detalles ingresados
                                    </td>
                                </tr>
                                <tr ng-repeat="detail in vm.cellar.detailsCellar">
                                    <td>{{$index + 1}}</td>
                                    <td>{{detail.product.codeIntegridad}}</td>
                                    <td>{{detail.product.name}}</td>
                                    <td>{{detail.adicional}}</td>
                                    <td>{{detail.quantity}}</td>
                                    <td>{{detail.product.unitOfMeasurementFull}}</td>
                                    <td>{{detail.costEach}}</td>
                                    <td>{{detail.total}}</td>
                                    <td ng-if="vm.newCNCellar">
                                        <!--<button type="button" title="Editar Producto" class="btn btn-primary btn-sm"
                                                ng-click="vm.editDetailCellar($index)" print-remove
                                                data-toggle="modal" data-target="#modalEditProduct">
                                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                        </button>-->
                                        <button type="button" title="Eliminar Producto" class="btn btn-primary btn-sm"
                                                ng-click="vm.removeDetailCellar($index)" print-remove>
                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>SUBTOTAL: </b></td>
                                    <td>{{(vm.cellar.subTotal).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 0%: </b></td>
                                    <td>{{(vm.cellar.baseNoTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>BASE 12%: </b></td>
                                    <td>{{(vm.cellar.baseTaxes).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>IVA: </b></td>
                                    <td>{{(vm.cellar.iva).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><b>TOTAL: </b></td>
                                    <td>{{(vm.cellar.total).toFixed(2)}}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="panel-footer" print-remove>
                <button type="button" title="Guardar Nota de Cŕedito" class="btn btn-success btn-sm" ng-disabled="vm.bill.total <= 0"
                        ng-show="vm.newCNCellar === true" ng-click="vm.saveCreditNoteCellar()">
                        <span class = "glyphicon glyphicon-floppy-save" aria-hidden = "true"></span>
                </button>
                <button print-btn type="button" title="Imprimir Nota de Crédito" class="btn btn-primary btn-sm"
                        ng-disabled="vm.newCNCellar === true" ng-click="vm.cancelCellar()">
                        <span class = "glyphicon glyphicon-print" aria-hidden = "true"></span>
                </button>
                <button type="button" title="Salir" class="btn btn-primary btn-sm"
                        ng-click="vm.cancelCreditNote()">
                        <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                </button>
            </div>
        </div>
    </div>

    <!--MODAL PARA AGREGAR PRODUCTOS-->
    <div id="modalEditProduct" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Detalle</h4>
                </div>
                <div class="modal-body">
                    <div class="col-md-6" >
                        <b>PRODUCTO: </b>
                        {{vm.detailC.product.name}}
                    </div>
                    <div class="col-md-6" >
                        <b>CANTIDAD: </b>
                        <input type="text" onkeypress="return ((event.which >= 48 && event.which <= 57) || (event.keyCode == 9 || event.keyCode == 8))"
                               ng-model="vm.detailC.quantity" class="form-control" maxlength="9">
                    </div>            
                </div>
                <div class="modal-footer">
                    <button type="button" title="Aceptar" class="btn btn-primary btn-sm" data-dismiss = "modal"
                            ng-click="acceptProduct()">
                            <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                    </button>
                    <button type="button" title="Salir" class="btn btn-primary btn-sm" data-dismiss = "modal"
                            ng-click="vm.detailC = undefined; vm.indexDetailC = undefined">
                            <span class = "glyphicon glyphicon-log-out" aria-hidden = "true"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>